## Installing and Configuring **`OSSEC`**

### What is `OSSEC`

`OSSEC` (Open Source Security) is a host-based intrusion detection system (HIDS). It has 3 main features:
    
    - Detects intrusions and malware:
        - Scans for rootkits, trojans and suspicious system changes 
        - Looks at logs for signs of attacks
    
    - File Integrity Monitoring:
        - Watching critical files and directories (/etc, /bin, etc.)
        - Alerts for unexpected changes 
    
    - Real Time Alerts and Active Response:
        - Sends alerts when threats are detected 
        - Automatically blocks attacker similar to Fail2Ban


### Steps 

1. Update system packages and install prerequisites

    ```bash 
    sudo apt update && sudo apt upgrade -y
    sudo apt install libz-dev libssl-dev libpcre2-dev build-essential libsystemd-dev -y
    ```

2. Temporarily remount /tmp 
    - We mounted /tmp as noexec but we need to temporarily use bash scripts from OSSEC

    ```bash 
    sudo mount -o remount,exec /tmp
    ```

3. Download and install OSSEC

    - Change to /tmp and get latest OSSEC source: 
    ```bash 

    cd/tmp
    curl -L -o ossec-hids-3.7.0.tar.gz https://github.com/ossec/ossec-hids/archive/refs/tags/3.7.0.tar.gz
    tar -zxvf ossec-hids-3.7.0.tar.gz
    cd ossec-hids-3.7.0
    ```

    - Run install script 
    ```bash 
    sudo ./install.sh
    ```

4. Installation options: 

| Prompt                                            | Answer                                                        |
| ------------------------------------------------- | ------------------------------------------------------------- |
| What kind of installation do you want?            | **local**                                                     |
| Where should OSSEC be installed?                  | **/var/ossec** (default)                                      |
| Do you want e-mail notification?                  | **yes** enter your email                                      |
| Do you want to use your smtp server               | **yes**                                                       |
| Do you want to use the integrity check daemon?    | **yes**                                                       |
| Do you want to use the rootkit detection engine?  | **yes**                                                       |
| Do you want to enable active response?            | **yes**                                                       |
| Do you want to enable the firewall-drop response? | **yes**                                                       |
| Do you want to add more IPs to the white list?    | **no**                                                        |
| Do you want to enable syslog?                     | **yes** (optional)                                            |


5. Start OSSEC: 

    ```bash 
    sudo /var/ossec/bin/ossec-control start
    ```

6. Configure e-mail alerts

    - Edit the config
        ```bash 
        sudo nano /var/ossec/etc/ossec.conf
        ```
    
    - Find email section 
        ```bash 
        <global>
            <email_notification>no</email_notification>
        </global>
        ```
    
    - Change to
        ```bash 
        <global>
            <email_notification>yes</email_notification>
            <email_to>you@example.com</email_to>
            <smtp_server>localhost</smtp_server>
        </global>
        ```
    
    - Save and restart
        ```bash 
        sudo /var/ossec/bin/ossec-control restart
        ``` 
    
7. Test setup 
    
    - Run manual scan 
        ```bash 
        sudo /var/ossec/bin/ossec-control restart
        sudo tail -f /var/ossec/logs/alerts/alerts.log
        ```

8. Enable OSSEC on boot

    ```bash 
    sudo systemctl enable ossec
    ```

9. Remount /tmp

    ```bash 
    sudo mount -o remount,noexec /tmp
    ```