# Installing and Configuring **Fail2Ban** for SSH 

### What is **Fail2Ban**

**Fail2Ban** is a tool used to mitigate brute force attacks using rules that alter your firewall to block specific IP addresses after a set number of unsuccessful login attempts

### Installing **Fail2Ban**

1. Update System and install **Fail2Ban**
    ```bash 
    sudo apt update -y 
    sudo apt install fail2ban -y
    ```

2. Confirm daemon 
    ```bash 
    systemctl status fail2ban.service
    ```
    - Should be loaded but inactive 

### Configuring **Fail2Ban**

1. Creating jail.local file 

    - Instead of modifying `jail.conf` we will be creating a `jail.local` file
    ```bash 
    cd /etc/fail2ban
    sudo cp jail.conf jail.local 
    sudo cp jail.conf jail.conf.bak
    ```

2. Edit jail.local

    - Open jail.local in a text editor 
    ```bash 
    sudo nano jail.local

    # Navigate to [sshd]
    ```

3. Enable sshd jail
    - We are implementing fail2ban to prevent SSH brute force attacks 
    ```bash 
    enabled = true
    ```

4. Set `bantime` to indefinite
    - As of Fail2Ban v0.10+ a ban can last forever or until explicitly unbanned 
    ```bash 
    bantime = -1
    ``` 

5. Set `findtime` and `maxretry` 

    - `findtime` is the window in which failed login attempts are counted 
    - `maxretry` is the max number of failed login attempts 

    ```bash 
    findtime = 300 # 5 minutes 
    maxrety = 3 

6. Save and exit 

7. Restart fail2ban 
    
    ```bash 
    sudo systemctl restart fail2ban.service
    ```

### Final settings 
```bash 
[sshd]
enabled = true 
bantime = -1 
findtime = 300 
maxretry = 3
```

### Unbanning IPs

1. Checking ban list 
```bash 
fail2ban-client status sshd
```

2. Unbanning 
```bash 
fail2ban-client set sshd unbanip <ip>
```